# 多进程

nodejs使用`cluster`模块

```javascript
const cluster=require('cluster')
if(cluster.isMaster){
  //fork 一个进程
  cluster.fork()
}else if(cluster.isWorker){
  //子进程 code
}
//fork会使得当前代码运行两次，但不是实际上运行两次，node会创建子进程来运行代码，并且，子进程可以共享tcp连接，比如listenPort
```

特定works事件和所有worker事件，用于对于master做状态汇报

```javascript
//所有的
cluster.on('message',(worker,message)=>{
    //message
})
//特定的work
cluster.fork().on('message',(message)=>{
  //mesage  
})
```

mast 创建和终止子进程，发送信息

```javascript
//创建
cluster.fork()
//终止特定子进程
cluster.fork().kill()
//send信息
worker.send()
```

子进程控制状态，子进程处理来自master的事件，都是使用全局对象process来实现

```javascript
process.on('message',(message)=>{
    //来自master的消息
})
process.exit(0) //正确退出，没有err信息
process.exit(code) //有err code，自定义
process.send(message)//send
```

一般worker事件

```javascript
{
    message，
    fork,
    online,
    exit,
   	disconnect,
   	listening,
}
```

事件解释

```javascript
cluster.on('fork',worker =>{
    //当子进程被fork后触发
})
cluster.on('online',worker =>{
    //当子进程运行后触发
})
cluster.on('exit',(worker,code,signal)=>{
    //code 来自exitd的ecoed
})
cluster.on('disconnect',(worker)=>{
    //简单的断开连接，不代表exit
  	//断开server
})
cluster.on('listening',(worker,address)=>{
    //address是一个对象
 	//address.port
})
```



